<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>è¨˜æ†¶ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }

    #display {
      font-size: 36px;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      min-height: 100px;
      white-space: pre-wrap;
      margin-bottom: 20px;
    }

    .answer-box {
      padding: 20px;
      background-color: #ddd;
      border-radius: 10px;
      text-align: center;
      font-size: 28px;
      cursor: pointer;
      user-select: none;
      margin-bottom: 20px;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      font-size: 20px;
      padding: 10px 20px;
      border: none;
      background-color: #1976d2;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #145ea8;
    }

    .mode-button.active {
      background-color: #f57c00;
    }

    #qa-list {
      margin-top: 20px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      border: 1px solid #999;
      padding: 10px;
      text-align: left;
    }

    input[type="checkbox"] {
      transform: scale(1.5);
    }
    .bottom-buttons {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin: 20px 0;
}

.bottom-buttons button {
  font-size: 24px;
  padding: 15px 30px;
  background-color: #388e3c;
  border: none;
  color: white;
  border-radius: 8px;
  cursor: pointer;
}

.bottom-buttons button:hover {
  background-color: #2e7d32;
}
    #version-label {
  position: fixed;
  top: 10px;
  right: 15px;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.3); /* è–„ãè¡¨ç¤º */
  pointer-events: none;
  user-select: none;
}
  </style>
</head>
<body>

  <h1>è¨˜æ†¶ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª</h1>

  <div class="buttons">
    <button onclick="setMode('all')" class="mode-button active">å…¨ã¦ã®å•é¡Œ</button>
    <button onclick="setMode('notMemorized')" class="mode-button">è¦šãˆã¦ã„ãªã„å•é¡Œã ã‘</button>
    <button onclick="setMode('weak')" class="mode-button">è‹¦æ‰‹ãªå•é¡Œ</button>
    <button onclick="setMode('list')" class="mode-button">å•é¡Œä¸€è¦§ã‚’è¦‹ã‚‹</button>
  </div>

  <div id="display"></div>
<div class="bottom-buttons">
  <button onclick="togglePause()">â¸ ä¸€æ™‚åœæ­¢</button>
  <button onclick="start()">â­ æ¬¡ã®å•é¡Œã¸</button>
</div>
  <div class="answer-box" onclick="showAnswer()">ã‚¿ãƒƒãƒ—ã—ã¦ç­”ãˆã‚’è¡¨ç¤º</div>
  <div style="margin: 10px 0;">
  <label>
    <input type="checkbox" id="memorizedCheck" onchange="toggleMemorizedCurrent()">
    ã“ã®å•é¡Œã¯è¦šãˆãŸ
  </label>
  <label style="margin-left: 20px;">
    <input type="checkbox" id="weakCheck" onchange="toggleWeakCurrent()">
    ã“ã®å•é¡Œã¯è‹¦æ‰‹
  </label>
</div>

  <div id="qa-list" style="display:none;"></div>

  <script>
    const dataVersion = "1.2.3"; // â† å•é¡Œã‚’ä¿®æ­£ã—ãŸã‚‰ "1.1" ã«ä¸Šã’ã‚‹ï¼
    function toggleMemorizedCurrent() {
  if (currentQAIndex !== null) {
    qaList[currentQAIndex].memorized = document.getElementById("memorizedCheck").checked;
    saveData();
  }
}
    
    let qaList = [
      { question: "æ–‡çŒ®ã‚„æ–‡å­—ã«ã‚ˆã‚‹è¨˜éŒ²ã®å­˜åœ¨ã—ãªã„æ™‚ä»£ã‚’ãªã‚“ã¨ã„ã†ï¼Ÿ", answer: "å…ˆå²æ™‚ä»£", memorized: false, weak: false },
      { question: "æœ€å¤ã®åŒ–çŸ³äººé¡ã§ã€åŸå§‹çš„ãªæ‰“è£½çŸ³å™¨ã‚’ä½¿ç”¨ã—ãŸã¨è¨€ã‚ã‚Œã‚‹ã®ã¯ï¼Ÿ", answer: "çŒ¿äºº", memorized: false, weak: false },
      { question: "ç¾åœ¨æœ€å¤ã¨ã•ã‚Œã‚‹700ä¸‡ã€œ600ä¸‡å¹´å‰ã®åŒ–çŸ³äººé¡ã§ã€ã‚¢ãƒ•ãƒªã‚«ã®ãƒãƒ£ãƒ‰ã§åŒ–çŸ³ãŒç™ºè¦‹ã•ã‚ŒãŸçŒ¿äººã¯ï¼Ÿ", answer: "ã‚µãƒ˜ãƒ©ãƒ³ãƒˆãƒ­ãƒ—ã‚¹(ãƒ»ãƒãƒ£ãƒ‡ãƒ³ã‚·ã‚¹)", memorized: false, weak: false },
      { question: "ã€Œå—ã®ã‚µãƒ«ã€ã‚’æ„å‘³ã™ã‚‹ã€å—ãƒ»æ±ã‚¢ãƒ•ãƒªã‚«å„åœ°ã§ç™ºè¦‹ã•ã‚ŒãŸçŒ¿äººã¯ï¼Ÿ", answer: "ã‚¢ã‚¦ã‚¹ãƒˆãƒ©ãƒ­ãƒ”ãƒ†ã‚¯ã‚¹", memorized: false, weak: false },
      { question: "ãŠã‚‚ã«æ—§çŸ³å™¨æ™‚ä»£ã«ä½¿ç”¨ã•ã‚ŒãŸã€çŸ³ã‚’æ‰“ã¡ç •ã„ã¦ä½œã‚‰ã‚ŒãŸçŸ³å™¨ã¯ï¼Ÿ", answer: "æ‰“è£½çŸ³å™¨", memorized: false, weak: false },
      { question: "æ›´æ–°ä¸–å‰æœŸã‹ã‚‰ä¸­æœŸ(ç´„240ä¸‡ã€œ20ä¸‡å¹´å‰)ã«ç”Ÿå­˜ã—ãŸã€ç«ã‚’ä½¿ã„å§‹ã‚ãŸã¨è¨€ã‚ã‚Œã‚‹åŒ–çŸ³äººé¡ã¯ï¼Ÿ", answer: "åŸäºº", memorized: false, weak: false },
      { question: "1890å¹´ä»£ã«ã€ã‚¸ãƒ£ãƒ¯å³¶ä¸­éƒ¨ã®ãƒˆãƒªãƒ‹ãƒ¼ãƒ«ã«ã¦è¦‹ã¤ã‹ã£ãŸåŸäººã®åŒ–çŸ³ã¯ä½•åŸäººï¼Ÿ", answer: "ã‚¸ãƒ£ãƒ¯åŸäºº", memorized: false, weak: false },
      { question: "1920ã€œ30å¹´ä»£ã«åŒ—äº¬éƒŠå¤–ã®å‘¨å£åº—ã‹ã‚‰ç™ºè¦‹ã•ã‚ŒãŸåŸäººã®åŒ–çŸ³ã¯ä½•åŸäººï¼Ÿ", answer: "åŒ—äº¬åŸäºº", memorized: false, weak: false },
      { question: "æ‰“è£½çŸ³å™¨ã®ä»£è¡¨ã§ã‚ã‚‹ã€æœ¨ã‚’ä¼ã£ãŸã‚Šã€å‰Šã‚‹ãŸã‚ã«ä½¿ã‚ã‚ŒãŸæ–§ã¯ï¼Ÿ", answer: "ãƒãƒ³ãƒ‰ã‚¢ãƒƒã‚¯ã‚¹(æ¡æ–§)", memorized: false, weak: false },
      { question: "æ›´æ–°ä¸–ä¸­æœŸã‹ã‚‰å¾ŒæœŸ(ç´„60ä¸‡ã€œ30ä¸‡å¹´å‰)ã«ç”Ÿå­˜ã—ãŸã€é«˜åº¦ãªçŸ³å™¨ã«ã‚ˆã‚Šæ¯›çš®ã®è¡£æœã‚’ä½œã£ãŸã¨è¨€ã‚ã‚Œã‚‹åŒ–çŸ³äººé¡ã¯ï¼Ÿ", answer: "æ—§äºº", memorized: false, weak: false },
      { question: "19ä¸–ç´€åŠã°ã€ãƒ‰ã‚¤ãƒ„ã®ã¨ã‚ã‚‹æ¸“è°·ã§ç™ºè¦‹ã•ã‚ŒãŸæ—§äººã¯ä½•äººï¼Ÿ", answer: "ãƒã‚¢ãƒ³ãƒ‡ãƒ«ã‚¿ãƒ¼ãƒ«äºº", memorized: false, weak: false },
      { question: "ãƒã‚¢ãƒ³ãƒ‡ãƒ«ã‚¿ãƒ¼ãƒ«äººã®åŒ–çŸ³ã®éºè·¡ã«ã¿ã‚‰ã‚ŒãŸã€å®—æ•™çš„è¡Œç‚ºã®å§‹ã¾ã‚Šã¨è¨€ã‚ã‚ŒãŸã‚‚ã®ã¯ä½•ï¼Ÿ", answer: "åŸ‹è‘¬ã®ç¿’æ…£", memorized: false, weak: false },
      { question: "çŸ³å¡Šã‹ã‚‰å‰¥ãå–ã£ãŸçŸ³ã®ã‹ã‘ã‚‰ã‹ã‚‰åˆ¶ä½œã—ãŸçŸ³å™¨ã‚’ãªã‚“ã¨ã„ã†ï¼Ÿ", answer: "å‰¥ç‰‡çŸ³å™¨", memorized: false, weak: false },
      { question: "ä½“å‹ãªã©ã€å®¹å§¿ã¯ç¾åœ¨ã®äººé–“ã¨é•ã„ãŒã‚ã¾ã‚Šã¿ã‚‰ã‚Œãªã„ã€ç´„20ä¸‡å¹´å‰ã«å‡ºç¾ã—ãŸåŒ–çŸ³äººé¡ã¯ï¼Ÿ", answer: "æ–°äºº", memorized: false, weak: false },
      { question: "å—è¥¿ãƒ•ãƒ©ãƒ³ã‚¹ã§ç™ºè¦‹ã•ã‚ŒãŸç¾ç”Ÿäººé¡ã®ç›´æ¥ã®ç¥–å…ˆã«ã‚ãŸã‚‹æ–°äººã¯ä½•äººï¼Ÿ", answer: "ã‚¯ãƒ­ãƒãƒ‹ãƒ§ãƒ³äºº", memorized: false, weak: false },
      { question: "åŒ—äº¬å—è¥¿éƒŠå¤–ã®å‘¨å£åº—ã®ä¸Šæ´ã§ç™ºè¦‹ã•ã‚ŒãŸæ–°äººã¯ä½•äººï¼Ÿ", answer: "å‘¨å£åº—ä¸Šæ´äºº", memorized: false, weak: false },
      { question: "ã‚¤ã‚¿ãƒªã‚¢é ˜åœ°ä¸­æµ·æ²¿å²¸ã®æ´ç©´ç¾¤ã§è¦‹ã¤ã‹ã£ãŸæ–°äººã¯ä½•äººï¼Ÿ", answer: "ã‚°ãƒªãƒãƒ«ãƒ‡ã‚£äºº", memorized: false, weak: false },
      { question: "å‹•ç‰©ã®éª¨ã‚„è§’ã€æ­¯ã§ä½œã‚‰ã‚ŒãŸé“å…·ã§ã€æ—§çŸ³å™¨æ™‚ä»£å¾ŒæœŸã«ç››ã‚“ã«ç”¨ã„ã‚‰ã‚ŒãŸé“å…·ã‚’ãªã‚“ã¨ã„ã†ï¼Ÿ", answer: "éª¨è§’å™¨", memorized: false, weak: false },
      { question: "ãƒ•ãƒ©ãƒ³ã‚¹è¥¿å—éƒ¨ã«ã‚ã‚‹ã€ç‹©çŒŸé¢¨æ™¯ãŒé®®ã‚„ã‹ã«æã‹ã‚ŒãŸæ´ç©´çµµç”»éºè·¡ã¯ï¼Ÿ", answer: "ãƒ©ã‚¹ã‚³ãƒ¼", memorized: false, weak: false },
      { question: "ã‚¹ãƒšã‚¤ãƒ³åŒ—éƒ¨ã«ã‚ã‚‹ç‰›ã‚„é¦¬ãŒå†™å®Ÿçš„ã«æã‹ã‚ŒãŸæ´ç©´çµµç”»éºè·¡ã¯ï¼Ÿ", answer: "ã‚¢ãƒ«ã‚¿ãƒŸãƒ©", memorized: false, weak: false },
      { question: "æ—§çŸ³å™¨æ™‚ä»£å¾ŒæœŸã«ä½œã‚‰ã‚ŒãŸã€è±Šä½œã‚„å¤šç”£ã‚’é¡˜ã†ç›®çš„ã§ä½œã‚‰ã‚ŒãŸã¨æ€ã‚ã‚Œã‚‹çŸ³ã®ãƒ´ã‚£ãƒ¼ãƒŠã‚¹åƒã¯ï¼Ÿ", answer: "å¥³æ€§è£¸åƒ", memorized: false, weak: false },
      { question: "æ—§çŸ³å™¨æ™‚ä»£ã‹ã‚‰æ–°çŸ³å™¨æ™‚ä»£ã¸ã®ç§»è¡ŒæœŸé–“ã§ã‚ã‚Šã€ã‚ˆã‚Šç·»å¯†ãªçŸ³å™¨ãŒä½œã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸæ™‚ä»£ã¯ï¼Ÿ", answer: "ä¸­çŸ³å™¨æ™‚ä»£", memorized: false, weak: false },
      { question: "ä¸­çŸ³å™¨æ™‚ä»£ã‹ã‚‰æ–°çŸ³å™¨æ™‚ä»£ã«ã‹ã‘ã¦ä½œã‚‰ã‚ŒãŸã€å°å‹ã®å‰¥ç‰‡çŸ³å™¨ã‚’ãªã‚“ã¨ã„ã†ï¼Ÿ", answer: "ç´°çŸ³å™¨", memorized: false, weak: false },
      { question: "æ•°åå›ã®æ°·æœŸã¨é–“æ°·æœŸãŒç¹°ã‚Šè¿”ã•ã‚ŒãŸã€æ–°ä¸–ä»£ã®ç´„260ä¸‡ã€œ1ä¸‡1700å¹´å‰ã®æœŸé–“ã‚’ãªã‚“ã¨ã„ã†ï¼Ÿ", answer: "æ›´æ–°ä¸–", memorized: false, weak: false },
      { question: "ãƒãƒ³ãƒ¢ã‚¹ã®çµ¶æ»…ãŒã“ã®è¾ºã‚Šã§ã‚ã‚‹ã€ç´„1ä¸‡1700ä¸‡ã‹ã‚‰ç¾åœ¨ã¾ã§ã®æœŸé–“ã‚’ãªã‚“ã¨ã„ã†ï¼Ÿ", answer: "å®Œæ–°ä¸–", memorized: false, weak: false },
    ];

    let isPaused = false;
    let isRunning = false;
    let currentIndex = 0;
    let currentSentence = "";
    let cancelDisplay = false;
    let displayElement;
    let answerBox;
    let currentAnswer = "";
    let currentMode = "all";
    let currentQAIndex = null; // â† è¡¨ç¤ºä¸­ã®å•é¡Œã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆè¿½è·¡ç”¨ï¼‰

    window.onload = () => {
  displayElement = document.getElementById("display");
  answerBox = document.querySelector(".answer-box");
  loadProgress();

  const saved = localStorage.getItem("qaData");
  const parsed = saved ? JSON.parse(saved) : null;
  if (parsed.version === dataVersion) {
  qaList = parsed.qaList;
} else {
  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒé•ã† â†’ è¦šãˆãŸæƒ…å ±ã‚’å¼•ãç¶™ã
  const oldList = parsed.qaList;

  qaList = qaList.map(newItem => {
    const match = oldList.find(oldItem => oldItem.question === newItem.question);
    return {
      ...newItem,
      memorized: match ? match.memorized : false,
      weak: match ? match.weak : false    // â† ã“ã‚Œã‚’è¿½åŠ ï¼
    };
  });

  saveData();
}

document.getElementById("version-label").textContent = "v" + dataVersion;
      
  renderList();
};

function saveData() {
  const dataToSave = {
    version: dataVersion,
    qaList: qaList
  };
  localStorage.setItem("qaData", JSON.stringify(dataToSave));
}

    function setMode(mode) {
      currentMode = mode;
      document.querySelectorAll(".mode-button").forEach(btn => btn.classList.remove("active"));
      if (mode === "all") {
        document.querySelectorAll(".mode-button")[0].classList.add("active");
        document.getElementById("qa-list").style.display = "none";
      } else if (mode === "notMemorized") {
        document.querySelectorAll(".mode-button")[1].classList.add("active");
        document.getElementById("qa-list").style.display = "none";
      } else if (mode === "weak") {               // â† ã“ã“ã‚’è¿½åŠ 
    document.querySelectorAll(".mode-button")[2].classList.add("active");
    document.getElementById("qa-list").style.display = "none";
      } else if (mode === "list") {
        document.querySelectorAll(".mode-button")[2].classList.add("active");
        document.getElementById("qa-list").style.display = "block";
        renderList();
      }
    }

    async function start() {
  if (isRunning) {
    cancelDisplay = true;
    while(isRunning) {
  await sleep(50);
}
  }

  isPaused = false;
  displayElement.textContent = "";
  answerBox.textContent = "ã‚¿ãƒƒãƒ—ã—ã¦ç­”ãˆã‚’è¡¨ç¤º";
  currentIndex = 0;
  isRunning = true;
  cancelDisplay = false;
  currentQAIndex = null;

  let candidates = qaList.map((q, i) => ({ ...q, index: i }));
  if (currentMode === "notMemorized") {
  candidates = candidates.filter(q => !q.memorized);
} else if (currentMode === "weak") {
  candidates = candidates.filter(q => q.weak);
}

  if (candidates.length === 0) {
    displayElement.textContent = "å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
    isRunning = false;
    return;
  }

  todayCount++;
saveProgress();
updateProgressUI();

  const qa = candidates[Math.floor(Math.random() * candidates.length)];
  currentSentence = qa.question;
  currentAnswer = qa.answer;
  currentQAIndex = qa.index;

  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’æ›´æ–°
  document.getElementById("memorizedCheck").checked = qaList[currentQAIndex].memorized;

  while (currentIndex < currentSentence.length) {
    if (cancelDisplay) break;
    if (isPaused) {
      await sleep(100);
      continue;
    }
    displayElement.textContent += currentSentence[currentIndex];
    currentIndex++;
    await sleep(100); // è¡¨ç¤ºé€Ÿåº¦ï¼ˆmsï¼‰
  }

  isRunning = false;
}
    
    function togglePause() {
      isPaused = !isPaused;
    }

    function showAnswer() {
      if (currentAnswer !== "") {
        answerBox.textContent = currentAnswer;
      }
    }

    function renderList() {
      const container = document.getElementById("qa-list");
      let html = "<table><tr><th>å•é¡Œ</th><th>ç­”ãˆ</th><th>è¦šãˆãŸ</th><th>è‹¦æ‰‹</th></tr>";
      qaList.forEach((qa, index) => {
        html += `<tr>
          <td>${qa.question}</td>
          <td>${qa.answer}</td>
          <td><input type="checkbox" onchange="toggleMemorized(${index})" ${qa.memorized ? "checked" : ""}></td>
          <td><input type="checkbox" onchange="toggleWeak(${index})" ${qa.weak ? "checked" : ""}></td>
        </tr>`;
      });
      html += "</table>";
      container.innerHTML = html;
    }

    function toggleMemorized(index) {
      qaList[index].memorized = !qaList[index].memorized;
      saveData();
    }

    function toggleWeak(index) {
  qaList[index].weak = !qaList[index].weak;
  saveData();
}


    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function toggleWeakCurrent() {
  if (currentQAIndex !== null) {
    qaList[currentQAIndex].weak = document.getElementById("weakCheck").checked;
    saveData();
  }
}
    let todayCount = 0;
let todayDate = new Date().toLocaleDateString();

function loadProgress() {
  const saved = localStorage.getItem("progressData");
  if (saved) {
    const parsed = JSON.parse(saved);
    if (parsed.date === todayDate) {
      todayCount = parsed.count;
    } else {
      todayCount = 0; // æ—¥ä»˜ãŒé•ã£ãŸã‚‰ãƒªã‚»ãƒƒãƒˆ
    }
  }
  updateProgressUI();
}

function saveProgress() {
  const saved = JSON.parse(localStorage.getItem("progressHistory") || "{}");
  saved[todayDate] = todayCount;
  localStorage.setItem("progressHistory", JSON.stringify(saved));
}

function loadProgress() {
  const saved = JSON.parse(localStorage.getItem("progressHistory") || "{}");
  todayCount = saved[todayDate] || 0;
  updateProgressUI();
}

function updateProgressUIs() {
  document.getElementById("progress").textContent = `ä»Šæ—¥è§£ã„ãŸå•é¡Œæ•°: ${todayCount}å•`;
}

function toggleHistory() {
  const panel = document.getElementById("history-panel");
  const list = document.getElementById("history-list");
  if (panel.style.display === "none") {
    panel.style.display = "block";
    renderHistory();
  } else {
    panel.style.display = "none";
  }
}

function renderHistory() {
  const saved = JSON.parse(localStorage.getItem("progressHistory") || "{}");
  const sortedDates = Object.keys(saved).sort((a, b) => new Date(b) - new Date(a));
  const list = document.getElementById("history-list");
  list.innerHTML = "";
  sortedDates.forEach(date => {
    const li = document.createElement("li");
    li.textContent = `${date}: ${saved[date]}å•`;
    list.appendChild(li);
  });
}

  </script>
  
<div id="version-label">v1.2.3</div>
<div id="progress" style="font-size: 18px; margin-top: 10px; color: #555;">
  ä»Šæ—¥è§£ã„ãŸå•é¡Œæ•°: 0å•
</div>
<div style="margin-top: 20px;">
  <button onclick="toggleHistory()">ğŸ“Š æ—¥ã€…ã®è¨˜éŒ²ã‚’è¦‹ã‚‹</button>
</div>
<div id="history-panel" style="display:none; margin-top: 10px; background: #fff; padding: 20px; border-radius: 8px;">
  <h3>æ—¥ã€…ã®è¨˜éŒ²</h3>
  <ul id="history-list" style="list-style: none; padding-left: 0;"></ul>
</div>

</body>
</html>
