<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カードゲーム試作</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    .player { display: inline-block; width: 45%; vertical-align: top; margin: 10px; border: 1px solid #333; padding: 10px; }
    .buttons button { margin: 5px; padding: 10px 20px; }
    .log { border: 1px solid #666; height: 200px; overflow-y: auto; margin: 10px; padding: 5px; text-align: left; }
  </style>
</head>
<body>
  <h1>カードゲーム試作</h1>
  <h3>30ポイント先取で勝利！</h3>

  <div id="game">
    <div class="player" id="p1">
      <h2>プレイヤー1</h2>
      <p>ポイント: <span id="score1">0</span></p>
      <div class="buttons">
        <h3>数字選択</h3>
        <button onclick="selectNumber(1,1)">1</button>
        <button onclick="selectNumber(1,2)">2</button>
        <button onclick="selectNumber(1,3)">3</button>
        <button onclick="selectNumber(1,4)">4</button>
        <h3>ルール選択</h3>
        <button onclick="selectRule(1,5)">ルール5</button>
        <button onclick="selectRule(1,6)">ルール6</button>
        <button onclick="selectRule(1,7)">ルール7</button>
        <button onclick="selectRule(1,8)">ルール8</button>
      </div>
    </div>

    <div class="player" id="p2">
      <h2>プレイヤー2</h2>
      <p>ポイント: <span id="score2">0</span></p>
      <div class="buttons">
        <h3>数字選択</h3>
        <button onclick="selectNumber(2,1)">1</button>
        <button onclick="selectNumber(2,2)">2</button>
        <button onclick="selectNumber(2,3)">3</button>
        <button onclick="selectNumber(2,4)">4</button>
        <h3>ルール選択</h3>
        <button onclick="selectRule(2,5)">ルール5</button>
        <button onclick="selectRule(2,6)">ルール6</button>
        <button onclick="selectRule(2,7)">ルール7</button>
        <button onclick="selectRule(2,8)">ルール8</button>
      </div>
    </div>
  </div>

  <h3>ログ</h3>
  <div class="log" id="log"></div>

  <script>
    let state = {
      numbers: {1: null, 2: null},   // 選んだ数字
      rules: {1: null, 2: null},     // 選んだルール
      scores: {1: 0, 2: 0},          // ポイント
    };

    function log(msg) {
      const logBox = document.getElementById("log");
      logBox.innerHTML += msg + "<br>";
      logBox.scrollTop = logBox.scrollHeight;
    }

    function selectNumber(player, num) {
      state.numbers[player] = num;
      log("プレイヤー" + player + " が数字を選びました。");
      checkRound();
    }

    function selectRule(player, rule) {
      state.rules[player] = rule;
      log("プレイヤー" + player + " がルール" + rule + "を選びました。");
      checkRound();
    }

    function checkRound() {
      if (state.numbers[1] && state.numbers[2] && state.rules[1] && state.rules[2]) {
        resolveRound();
      }
    }

    function resolveRound() {
      let finalRule = Math.max(state.rules[1], state.rules[2]); // 大きい番号優先
      log("採用ルール: " + finalRule);

      let n1 = state.numbers[1];
      let n2 = state.numbers[2];
      let winner = null;

      switch(finalRule) {
        case 1: if (n1 > n2) winner = 1; else if (n2 > n1) winner = 2; break;
        case 2: if (n1 < n2) winner = 1; else if (n2 < n1) winner = 2; break;
        case 3: if (n1 % 2 === 0) winner = 1; else if (n2 % 2 === 0) winner = 2; break;
        case 4: if (n1 % 2 === 1) winner = 1; else if (n2 % 2 === 1) winner = 2; break;
        case 5: if (n1 === 1) winner = 1; else if (n2 === 1) winner = 2; break;
        case 6: if (n1 === 2) winner = 1; else if (n2 === 2) winner = 2; break;
        case 7: if (n1 === 3) winner = 1; else if (n2 === 3) winner = 2; break;
        case 8: if (n1 === 4) winner = 1; else if (n2 === 4) winner = 2; break;
      }

      if (winner) {
        let points = 9 - finalRule; // ルール番号に応じたポイント
        state.scores[winner] += points;
        document.getElementById("score" + winner).textContent = state.scores[winner];
        log("プレイヤー" + winner + " の勝利！ +" + points + "ポイント");
        if (state.scores[winner] >= 30) {
          log("🎉 プレイヤー" + winner + " が30点に到達し完全勝利！");
        }
      } else {
        log("このラウンドは引き分け！");
      }

      // リセット
      state.numbers = {1: null, 2: null};
      state.rules = {1: null, 2: null};
    }
  </script>
</body>
</html>
