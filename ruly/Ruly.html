<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ è©¦ä½œ</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    .player { display: inline-block; width: 45%; vertical-align: top; margin: 10px; border: 1px solid #333; padding: 10px; }
    .buttons button { margin: 5px; padding: 10px 20px; }
    .log { border: 1px solid #666; height: 200px; overflow-y: auto; margin: 10px; padding: 5px; text-align: left; }
  </style>
</head>
<body>
  <h1>ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ è©¦ä½œ</h1>
  <h3>30ãƒã‚¤ãƒ³ãƒˆå…ˆå–ã§å‹åˆ©ï¼</h3>

  <div id="game">
    <div class="player" id="p1">
      <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1</h2>
      <p>ãƒã‚¤ãƒ³ãƒˆ: <span id="score1">0</span></p>
      <div class="buttons">
        <h3>æ•°å­—é¸æŠ</h3>
        <button onclick="selectNumber(1,1)">1</button>
        <button onclick="selectNumber(1,2)">2</button>
        <button onclick="selectNumber(1,3)">3</button>
        <button onclick="selectNumber(1,4)">4</button>
        <h3>ãƒ«ãƒ¼ãƒ«é¸æŠ</h3>
        <button onclick="selectRule(1,5)">ãƒ«ãƒ¼ãƒ«5</button>
        <button onclick="selectRule(1,6)">ãƒ«ãƒ¼ãƒ«6</button>
        <button onclick="selectRule(1,7)">ãƒ«ãƒ¼ãƒ«7</button>
        <button onclick="selectRule(1,8)">ãƒ«ãƒ¼ãƒ«8</button>
      </div>
    </div>

    <div class="player" id="p2">
      <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2</h2>
      <p>ãƒã‚¤ãƒ³ãƒˆ: <span id="score2">0</span></p>
      <div class="buttons">
        <h3>æ•°å­—é¸æŠ</h3>
        <button onclick="selectNumber(2,1)">1</button>
        <button onclick="selectNumber(2,2)">2</button>
        <button onclick="selectNumber(2,3)">3</button>
        <button onclick="selectNumber(2,4)">4</button>
        <h3>ãƒ«ãƒ¼ãƒ«é¸æŠ</h3>
        <button onclick="selectRule(2,5)">ãƒ«ãƒ¼ãƒ«5</button>
        <button onclick="selectRule(2,6)">ãƒ«ãƒ¼ãƒ«6</button>
        <button onclick="selectRule(2,7)">ãƒ«ãƒ¼ãƒ«7</button>
        <button onclick="selectRule(2,8)">ãƒ«ãƒ¼ãƒ«8</button>
      </div>
    </div>
  </div>

  <h3>ãƒ­ã‚°</h3>
  <div class="log" id="log"></div>

  <script>
    let state = {
      numbers: {1: null, 2: null},   // é¸ã‚“ã æ•°å­—
      rules: {1: null, 2: null},     // é¸ã‚“ã ãƒ«ãƒ¼ãƒ«
      scores: {1: 0, 2: 0},          // ãƒã‚¤ãƒ³ãƒˆ
    };

    function log(msg) {
      const logBox = document.getElementById("log");
      logBox.innerHTML += msg + "<br>";
      logBox.scrollTop = logBox.scrollHeight;
    }

    function selectNumber(player, num) {
      state.numbers[player] = num;
      log("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + player + " ãŒæ•°å­—ã‚’é¸ã³ã¾ã—ãŸã€‚");
      checkRound();
    }

    function selectRule(player, rule) {
      state.rules[player] = rule;
      log("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + player + " ãŒãƒ«ãƒ¼ãƒ«" + rule + "ã‚’é¸ã³ã¾ã—ãŸã€‚");
      checkRound();
    }

    function checkRound() {
      if (state.numbers[1] && state.numbers[2] && state.rules[1] && state.rules[2]) {
        resolveRound();
      }
    }

    function resolveRound() {
      let finalRule = Math.max(state.rules[1], state.rules[2]); // å¤§ãã„ç•ªå·å„ªå…ˆ
      log("æ¡ç”¨ãƒ«ãƒ¼ãƒ«: " + finalRule);

      let n1 = state.numbers[1];
      let n2 = state.numbers[2];
      let winner = null;

      switch(finalRule) {
        case 1: if (n1 > n2) winner = 1; else if (n2 > n1) winner = 2; break;
        case 2: if (n1 < n2) winner = 1; else if (n2 < n1) winner = 2; break;
        case 3: if (n1 % 2 === 0) winner = 1; else if (n2 % 2 === 0) winner = 2; break;
        case 4: if (n1 % 2 === 1) winner = 1; else if (n2 % 2 === 1) winner = 2; break;
        case 5: if (n1 === 1) winner = 1; else if (n2 === 1) winner = 2; break;
        case 6: if (n1 === 2) winner = 1; else if (n2 === 2) winner = 2; break;
        case 7: if (n1 === 3) winner = 1; else if (n2 === 3) winner = 2; break;
        case 8: if (n1 === 4) winner = 1; else if (n2 === 4) winner = 2; break;
      }

      if (winner) {
        let points = 9 - finalRule; // ãƒ«ãƒ¼ãƒ«ç•ªå·ã«å¿œã˜ãŸãƒã‚¤ãƒ³ãƒˆ
        state.scores[winner] += points;
        document.getElementById("score" + winner).textContent = state.scores[winner];
        log("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + winner + " ã®å‹åˆ©ï¼ +" + points + "ãƒã‚¤ãƒ³ãƒˆ");
        if (state.scores[winner] >= 30) {
          log("ğŸ‰ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + winner + " ãŒ30ç‚¹ã«åˆ°é”ã—å®Œå…¨å‹åˆ©ï¼");
        }
      } else {
        log("ã“ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¯å¼•ãåˆ†ã‘ï¼");
      }

      // ãƒªã‚»ãƒƒãƒˆ
      state.numbers = {1: null, 2: null};
      state.rules = {1: null, 2: null};
    }
  </script>
</body>
</html>
